<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>BILIM JANGI ONLINE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap");
      body { font-family: "Montserrat", sans-serif; background: #020617; color: #f8fafc; min-height: 100vh; margin: 0; display: flex; align-items: center; justify-content: center; overflow: hidden; }
      .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
      .gradient-text { background: linear-gradient(135deg, #22d3ee 0%, #818cf8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
      #wheel { width: 260px; height: 260px; border-radius: 50%; border: 8px solid #1e293b; transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); position: relative; }
      .pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 25px solid #fbbf24; z-index: 50; }
    </style>
  </head>
  <body>
    <div id="app" class="w-full max-w-md px-4 text-center"></div>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBaUpRxN4xHSoEY3CGp0TI3wY2BQ3U8OTM",
        authDomain: "topishmoq-4073b.firebaseapp.com",
        databaseURL: "https://topishmoq-4073b-default-rtdb.firebaseio.com",
        projectId: "topishmoq-4073b",
        storageBucket: "topishmoq-4073b.firebasestorage.app",
        messagingSenderId: "1026823461436",
        appId: "1:1026823461436:web:99791f92b195f820e6c139",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      let roomId = "", myName = "";
      const riddles = [
        { q: "Mitti mitti bo'yi bor, yetti qavat to'ni bor.", a: "PIYOZ" },
        { q: "Yer ostida oltin qoziq.", a: "SABZI" },
        { q: "Suvda tug'iladi, suvda o'ladi.", a: "TUZ" },
        { q: "Kunduzi uxlab, kechasi uchar.", a: "SOYABON" },
        { q: "Tili boru jag'i yo'q, xabar berar joni yo'q.", a: "XAT" },
        { q: "O'zi koptokdek, ichi qondek, tishi donday.", a: "ANOR" },
        { q: "Osmonda bir patnis non, cheti tishlangan hamon.", a: "OY" },
        { q: "Qora sigirim yaladi, qizil sigirim qochdi.", a: "OT" },
        { q: "Oyog'i yo'q, qo'li yo'q, eshikni ochar.", a: "SHAMOL" },
        { q: "Yozda kiyinar, qishda yechinar.", a: "DARAXT" },
        { q: "Usti tosh, osti tosh, o'rtasida mitti bosh.", a: "TOSHBAQA" },
        { q: "O'zi bitta, ko'zi mingtadan ko'p.", a: "GALVIR" },
        { q: "Qanoti bor, uchmaydi, oyog'i bor, yurmaydi.", a: "BALIQ" },
        { q: "Qizil uyning ichida qora bolalar.", a: "TARVUZ" },
        { q: "Yursa izi yo'q, kelsa ovozi yo'q.", a: "KEMA" },
        { q: "Bir ko'zada ikki xil suv.", a: "TUXUM" },
        { q: "Dumi bor, ot emas, qanoti bor, qush emas.", a: "SAMOLYOT" },
        { q: "Tugmasi bor, sasi yo'q, dunyodan xabari bor.", a: "TELEVIZOR" },
        { q: "Kelsang kelaverasan, o'zing bilan olib keta olmaysan.", a: "KOLANKA" },
        { q: "Uzoqdan ko'rinsa tog'dek, yaqiniga borsa bog'dek.", a: "PAXTA" }
      ];
      function showStart() {
        document.getElementById("app").innerHTML = `
          <div class="glass p-8 rounded-[2rem]">
            <h1 class="text-3xl font-black mb-6 gradient-text italic">BILIM JANGI</h1>
            <input id="nInp" placeholder="ISMINGIZ (LOTIN)" class="w-full p-4 mb-3 rounded-xl bg-slate-900 border border-slate-700 font-bold text-center text-white outline-none">
            <input id="rInp" type="number" placeholder="XONA KODI" class="w-full p-4 mb-6 rounded-xl bg-slate-900 border border-slate-700 font-bold text-center text-white outline-none">
            <button onclick="join()" class="w-full bg-cyan-600 py-4 rounded-xl font-bold uppercase active:scale-95 shadow-lg">Kirish</button>
          </div>`;
      }
      function join() {
        roomId = document.getElementById("rInp").value;
        myName = document.getElementById("nInp").value.toUpperCase();
        if (!roomId || !myName) return alert("Ism va xona kodini kiriting!");
        db.ref("rooms/" + roomId + "/players/" + myName).set({ score: 0 });
        db.ref("rooms/" + roomId).on("value", (snap) => render(snap.val()));
      }
      function render(data) {
        if (!data) return;
        const players = data.players || {};
        const pKeys = Object.keys(players);
        let html = `<div class="grid grid-cols-2 gap-2 mb-6">` +
          pKeys.map((k) => `<div class="glass p-2 rounded-lg ${k === myName ? "border-cyan-500 border-2" : ""}"><p class="text-[10px] font-bold opacity-70">${k}</p><p class="text-xl font-black">${players[k].score}</p></div>`).join("") +
          `</div>`;
        html += `<div class="relative inline-block mb-6"><div class="pointer"></div><div id="wheel" style="transform: rotate(${data.rot || 0}deg); background: conic-gradient(#22d3ee 0% 50%, #f43f5e 50% 100%)"></div></div>
          <button onclick="spin()" class="w-full bg-white text-black py-4 rounded-xl font-black uppercase active:scale-95 shadow-xl">Aylantirish</button>`;
        const modalCheck = document.getElementById("modal");
        if (data.question && !data.answered && !modalCheck) { showModal(data.question); } 
        else if (data.answered && modalCheck) { modalCheck.remove(); }
        document.getElementById("app").innerHTML = html;
      }
      function spin() {
        const rot = Math.random() * 360 + 1440 + Math.random() * 360;
        const qIdx = Math.floor(Math.random() * riddles.length);
        db.ref("rooms/" + roomId).update({ rot: rot, question: riddles[qIdx], answered: false });
      }
      function showModal(q) {
        const m = document.createElement("div"); m.id = "modal"; m.className = "fixed inset-0 bg-slate-950/95 flex items-center justify-center p-4 z-50";
        m.innerHTML = `<div class="glass p-8 rounded-3xl w-full max-w-sm text-center border border-white/20">
          <h2 class="text-xl font-bold mb-6 italic">"${q.q}"</h2>
          <input id="ans" placeholder="JAVOBNI YOZING" class="w-full p-4 mb-4 rounded-xl bg-slate-900 border border-slate-700 text-center font-bold text-white outline-none">
          <button onclick="check('${q.a}')" class="w-full bg-cyan-600 py-4 rounded-xl font-bold uppercase shadow-lg">Yuborish</button>
        </div>`;
        document.body.appendChild(m);
      }
      function check(correct) {
        const val = document.getElementById("ans").value.toUpperCase();
        if (val === correct) {
          db.ref("rooms/" + roomId + "/players/" + myName + "/score").transaction((s) => (s || 0) + 10);
          alert("TO'G'RI!");
        } else { alert("XATO! To'g'ri javob: " + correct); }
        db.ref("rooms/" + roomId).update({ answered: true });
      }
      showStart();
    </script>
  </body>
</html>
